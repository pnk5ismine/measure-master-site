<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Measure Master — 사용법</title>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <link rel="preload" as="image" href="/images/mm_logo_small.jpg" />
  <style>
    :root { --bg:#0b0d12; --card:#121622; --muted:#9aa4b2; --pri:#5eead4; --border:#1e2230; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif;background:var(--bg);color:#e7edf5}
    a{color:var(--pri);text-decoration:none} a:hover{text-decoration:underline}
    header,main,footer{max-width:1100px;margin:0 auto;padding:16px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo-img{width:28px;height:28px;border-radius:6px;object-fit:contain;background:#0e1422}
    nav a{margin-left:16px;color:#cfd6e4}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:22px}
    h1{margin:8px 0 2px;font-size:22px}
    p.muted{color:var(--muted);margin:2px 0 0}
    .howtouse{ margin-top:10px; }

/* 그리드 기본(데스크톱 3열, 태블릿 2열) */
.howtouse-grid{
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}
@media (max-width:1024px){
  .howtouse-grid{ grid-template-columns: repeat(2, 1fr); }
}

/* ✅ 데스크톱/태블릿: 카드 높이 고정(행 균일) */
@media (min-width:641px){
  .howtouse-item{ 
    display:block;            /* 안전 */
    aspect-ratio: 1 / 2;      /* 필요하면 3/4, 4/5 등으로 조절 가능 */
    position: relative;
    overflow: hidden;
  }
  .howtouse-item img{
    width:100%;
    height:100%;              /* 카드 높이에 맞춤 */
    object-fit: cover;        /* 크롭해서 균일 높이 유지 */
    display:block;
  }
}

/* 📱 모바일: 1열, 원본 비율 */
@media (max-width:640px){
  .howtouse-grid{ grid-template-columns: 1fr; }
  .howtouse-item{ aspect-ratio: auto; }
  .howtouse-item img{ height:auto; object-fit: contain; }
}
    .howtouse-item{ position:relative; display:block; border-radius:10px; overflow:hidden; background:#0f1320; aspect-ratio:1/2; border:1px solid var(--border); }
    .howtouse-item img{ width:100%; height:100%; object-fit:cover; display:block; image-rendering:auto; transition:transform .2s ease-out, opacity .2s ease-out; opacity:.98; }
    .howtouse-item:hover img{ transform:scale(1.02); opacity:1; }
    .overlay{ position:absolute; inset:0; pointer-events:none; }
    .olabel{ position:absolute; white-space:pre-wrap; color:#000; text-shadow:none; filter:none; }
    .anchor-topstart{ transform: translate(0,0); }
    .anchor-topcenter{ transform: translate(-50%,0); left:50%; }
    .anchor-topend{ transform: translate(-100%,0); }
    .debug .olabel { outline:1px dashed rgba(0,0,0,.35); }
    footer{margin:30px auto 60px;text-align:center;color:var(--muted);font-size:14px}
    /* JS 작동 확인용 토스트 */
    #ping{position:fixed;top:8px;right:8px;background:#16a34a;color:#fff;padding:6px 10px;border-radius:8px;z-index:99999;font:12px/1 system-ui}
  </style>
<style>
  /* 03~06만 원본 비율 유지(크롭 금지) */
  .howtouse-item.ratio-free{ aspect-ratio: unset !important; }
  .howtouse-item.ratio-free img{
    height: auto !important;
    object-fit: contain !important; /* cover → contain */
  }
</style>
</head>
<body>
<header>
  <div class="brand">
    <img src="/images/mm_logo_small.jpg" alt="Measure Master" class="logo-img" width="28" height="28"
         loading="eager" fetchpriority="high"
         onerror="this.onerror=null; this.src='/images/mm_logo_small.png';" />
    <strong>Measure Master</strong>
  </div>
  <nav>
    <a href="/">홈</a>
    <a href="/howtouse.html">사용법</a>
    <a href="/reviews.html">사용후기</a>
    <a href="/privacy.html">개인정보처리방침</a>
  </nav>
</header>

<main>
  <section class="card howtouse">
    <h1>사용법</h1>
    <p class="muted">총 22장 · 이미지를 탭하면 원본이 새 탭에서 열립니다.</p>
    <div id="howtoGrid" class="howtouse-grid"></div>
  </section>
</main>

<footer>
  © <span id="year"></span> Measure Master. All rights reserved.
</footer>

<script>
/* howtouse: 최소 렌더러(22장 강제 렌더, JSON 실패해도 이미지 노출) */
(function(){
  const GRID_ID       = "howtoGrid";                   // <div id="howtoGrid" ...>
  const TOTAL_PAGES   = 22;
  const IMG_DIRS      = ["/images/howtouse", "/image/howtouse"]; // 둘 다 시도
  const IMG_PREFIX    = "howtouse";
  const IMG_EXTS      = ["jpg","png","jpeg","webp"];
  const OVERLAYS_JSON = "/assets/data/howtouse_overlays_pc.json?v=pc26"; // ★ 숫자만 올리면 캐시 무력화
  const STRINGS_JSON  = "/assets/data/strings_ko_pc.json?v=pc26";
  const BASE_H        = 600; // dy 스케일 기준

  function grid(){
    return document.getElementById(GRID_ID)
        || document.querySelector(".howtouse-grid")
        || document.querySelector(".howto-grid");
  }

  function createImage(num){
    const img = new Image();
    img.alt = `사용법 ${num}`;
    img.loading = "eager"; // 우선 즉시 로드(안정화 후 lazy로 바꿔도 됨)
    const cands = [];
    for(const d of IMG_DIRS) for(const e of IMG_EXTS) cands.push(`${d}/${IMG_PREFIX}${num}.${e}`);
    let i=0;
    img.onerror = ()=>{ if(++i<cands.length) img.src=cands[i]; else img.onerror=null; };
    img.src = cands[i];
    return img;
  }

  function parseColorHex(hex){
    if(!hex) return null;
    let s=String(hex).trim();
    if(s.startsWith("0x")) s=s.slice(2);
    if(s.startsWith("#")) s=s.slice(1);
    if(s.length===8){ const a=parseInt(s.slice(0,2),16)/255, r=parseInt(s.slice(2,4),16), g=parseInt(s.slice(4,6),16), b=parseInt(s.slice(6,8),16); return `rgba(${r},${g},${b},${a})`; }
    if(s.length===6){ const r=parseInt(s.slice(0,2),16), g=parseInt(s.slice(2,4),16), b=parseInt(s.slice(4,6),16); return `rgb(${r},${g},${b})`; }
    return null;
  }
  function anchorClass(align="TopStart"){
    const a=String(align).toLowerCase();
    if(a.includes("center")) return "anchor-topcenter";
    if(a.includes("end"))    return "anchor-topend";
    return "anchor-topstart";
  }
  function layoutLabels(card, labels, STR){
    let ol = card.querySelector(".overlay");
    if(!ol){ ol=document.createElement("div"); ol.className="overlay"; card.appendChild(ol); }
    ol.innerHTML = "";

    const rect = card.getBoundingClientRect();
    const W = rect.width, H = rect.height;
    const scale = H/BASE_H;

    (labels||[]).forEach(cfg=>{
      const el = document.createElement("div");
      el.className = "olabel " + anchorClass(cfg.align);
      const text = (STR && STR[cfg.key]) || cfg.key || "";
      el.textContent = text;

      if(cfg.bold) el.style.fontWeight = "700";
      if(cfg.sizeSp) el.style.fontSize = cfg.sizeSp + "px";
      if(cfg.lineHeightSp) el.style.lineHeight = cfg.lineHeightSp + "px";
      if(cfg.textAlign) el.style.textAlign = ({Center:"center", End:"right", Start:"left"}[cfg.textAlign]||"left");
      const col = parseColorHex(cfg.colorHex); if(col) el.style.color = col;
      if(cfg.maxWidthPercent) el.style.maxWidth = (cfg.maxWidthPercent*W) + "px";

      if(typeof cfg.xPercent==="number" && typeof cfg.yPercent==="number"){
        el.style.left = (cfg.xPercent*100) + "%";
        el.style.top  = (cfg.yPercent*100) + "%";
      }else{
        const a = String(cfg.align||"").toLowerCase();
        const base = a.includes("center") ? W/2 : a.includes("end") ? W : 0;
        el.style.left = (base + (cfg.dx||0)*scale) + "px";
        el.style.top  = ((cfg.dy||0)*scale) + "px";
      }
      ol.appendChild(el);
    });
  }

  function buildMap(pages){
    const map={};
    (pages||[]).forEach(group=>{
      const any = group.find(it=>/^htu(\d{2})_/.test(it.key));
      if(any){ const num = any.key.match(/^htu(\d{2})_/)[1]; map[num]=group; }
    });
    return map;
  }

  async function loadJson(url){
    const r = await fetch(url, {cache:"no-store"});
    if(!r.ok) throw new Error(`HTTP ${r.status} @ ${url}`);
    return r.json();
  }

  async function init(){
    const container = grid();
    if(!container){ console.error("[howtouse] grid container not found"); return; }
    container.innerHTML = "";

    // JSON은 실패해도 이미지 렌더는 계속
    let overlays=null, strings=null;
    try{ [overlays, strings] = await Promise.all([loadJson(OVERLAYS_JSON), loadJson(STRINGS_JSON)]); }
    catch(e){ console.warn("[howtouse] JSON load warn:", e.message); }
    const map = overlays?.pages ? buildMap(overlays.pages) : {};

    for(let i=1;i<=TOTAL_PAGES;i++){
      const num = String(i).padStart(2,"0");
      try{
        const a = document.createElement("a");
        a.className = "howtouse-item";
        a.target = "_blank"; a.rel="noopener";
        a.href = `${IMG_DIRS[0]}/${IMG_PREFIX}${num}.jpg`; // 링크용

        const img = createImage(num);
        a.appendChild(img);

        const ol = document.createElement("div");
        ol.className = "overlay";
        a.appendChild(ol);

        container.appendChild(a);

        const labels = map[num];
        if(labels){
          const STR = strings||{};
          const render = ()=> layoutLabels(a, labels, STR);
          img.addEventListener("load", render);
          render();
          new ResizeObserver(render).observe(a);
        }
      }catch(err){
        console.error("[howtouse] render error @", num, err);
      }
    }
  }

  // 최소 스타일(없으면 추가)
  (function injectCSS(){
    if (document.getElementById("__howtouse_min_css")) return;
    const s = document.createElement("style");
    s.id="__howtouse_min_css";
    s.textContent = `
      .overlay{position:absolute;inset:0;pointer-events:none}
      .olabel{position:absolute;color:#000;font-weight:400}
      .olabel.anchor-topcenter{transform:translateX(-50%)}
      .olabel.anchor-topend{transform:translateX(-100%)}
      .howtouse-item{position:relative;overflow:hidden;border:1px solid var(--border,#1e2230);border-radius:10px;background:#0f1320}
      .howtouse-item img{width:100%;height:auto;object-fit:cover;display:block}
    `;
    document.head.appendChild(s);
  })();

  window.addEventListener("load", init);
})();
</script>

<style id="__pc_rollback_css">
/* PC/태블릿: 예전 레이아웃으로 복구(3열/2열, 고정비율+cover) */
.howtouse-grid, .howto-grid { gap:12px; }

@media (min-width:1025px){
  .howtouse-grid, .howto-grid{ display:grid!important; grid-template-columns:repeat(3,1fr)!important; }
}
@media (min-width:641px) and (max-width:1024px){
  .howtouse-grid, .howto-grid{ display:grid!important; grid-template-columns:repeat(2,1fr)!important; }
}

@media (min-width:641px){
  .howtouse-item, .howto-item{
    position:relative; overflow:hidden;
    aspect-ratio:1/2!important;
  }
  .howtouse-item img, .howto-item img{
    width:100%; height:100%!important; object-fit:cover!important; display:block;
  }
}

/* 모바일: 1열(PC에 영향 없음) */
@media (max-width:640px){
  .howtouse-grid, .howto-grid{ display:grid!important; grid-template-columns:1fr!important; }
  .howtouse-item, .howto-item{ aspect-ratio:auto!important; }
  .howtouse-item img, .howto-item img{ height:auto!important; object-fit:contain!important; }
}

/* 오버레이 기본(없으면 추가) */
.overlay{ position:absolute; inset:0; pointer-events:none; }
.olabel{ position:absolute; color:#000; font-weight:400; }
.olabel.anchor-topcenter{ transform:translateX(-50%); }
.olabel.anchor-topend{ transform:translateX(-100%); }
</style>
<style id="__mobile_nav_fix">
/* 기본: 데스크톱/태블릿 메이슨리, 모바일 1열 */
@media (min-width: 641px){
  /* ✅ 그리드를 끄고 컬럼 레이아웃으로 전환 (공백 없이 촘촘히) */
  .howtouse-grid{
    display: block !important;   /* grid → block */
    column-count: 3;             /* 데스크톱 3열 */
    column-gap: 12px;
  }
  @media (min-width: 641px) and (max-width: 1023px){
    .howtouse-grid{ column-count: 2; }  /* 태블릿 2열 */
  }

  .howtouse-item{
    display: block;
    width: 100%;
    margin: 0 0 12px;            /* 열 사이 간격 */
    break-inside: avoid;         /* 항목 분리(줄 바꿈 금지) */
    position: relative;          /* 오버레이 기준 */
    overflow: hidden;
    border: 1px solid var(--border, #1e2230);
    border-radius: 10px;
    background: #0f1320;
  }
  .howtouse-item img{
    width: 100%;
    height: auto;                /* ✅ 원본 비율 유지 */
    object-fit: contain;         /* ✅ 크롭 금지 → 라벨 왜곡 방지 */
    display: block;
  }
}

/* 📱 모바일: 1열 */
@media (max-width: 640px){
  .howtouse-grid{
    display: grid !important;
  }
  .howtouse-grid{ grid-template-columns: 1fr; gap: 12px; }
  .howtouse-item{
    position: relative;
    overflow: hidden;
    border: 1px solid var(--border, #1e2230);
    border-radius: 10px;
    background: #0f1320;
  }
  .howtouse-item img{
    width: 100%;
    height: auto;
    object-fit: contain;         /* 모바일도 왜곡/크롭 방지 */
    display: block;
  }
}

/* 오버레이 기본 (없다면 추가) */
.overlay{ position:absolute; inset:0; pointer-events:none; }
.olabel{ position:absolute; color:#000; font-weight:400; }
.olabel.anchor-topcenter{ transform:translateX(-50%); }
.olabel.anchor-topend{    transform:translateX(-100%); }

</style>

</body>
</html>
