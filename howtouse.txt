<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Measure Master â€” How to Use</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/images/mm_logo.png" />
  <link rel="preload" as="image" href="/images/mm_logo.png" />

  <style>
    :root {
      --bg:#f6f8fc;
      --card:#ffffff;
      --border:#d6dbe7;
      --muted:#475569;
      --text:#0f172a;
      --accent:#0ea5e9;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans',sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}

    header,main,footer{
      max-width:1100px;
      margin:0 auto;
      padding:16px;
    }

/* ===== Header layout (index/privacy style) ===== */
header{display:flex;flex-direction:column;gap:10px}
.header-top{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
}
.header-bottom{
  display:flex;align-items:center;justify-content:center;
}

.right{display:flex;align-items:center;gap:12px}

nav{
  display:flex;gap:14px;align-items:center;flex-wrap:wrap;
  justify-content:center;
}
nav a{color:var(--muted)}

.lang{display:flex;gap:6px;align-items:center}
.lang button{
  border:1px solid var(--border);
  background:#ffffff;
  color:var(--text);
  border-radius:999px;
  padding:6px 10px;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  gap:6px;
  font-size:12px;
}
.lang button.active{outline:2px solid #2dd; font-weight:600}
.lang .flag{line-height:1}
.lang .label{letter-spacing:.04em}

/* ===== Desktop: single-row feel (brand left, nav+lang right) ===== */
@media (min-width: 721px){
  header{flex-direction:row;align-items:center;justify-content:space-between;gap:12px}
  .header-top{flex:0 0 auto}
  .header-bottom{flex:1 1 auto;justify-content:flex-end}
  .right{justify-content:flex-end}
  nav{justify-content:flex-end}
}

/* ===== Mobile: 2 rows (brand left + lang right), nav centered ===== */
@media (max-width: 720px){
  .header-top{width:100%}
  .header-bottom{width:100%}
  nav{justify-content:center}

  /* ëª¨ë°”ì¼ì—ì„œëŠ” ê¹ƒë°œ ìˆ¨ê¸°ê³  í…ìŠ¤íŠ¸ë§Œ */
  .lang .flag{display:none}
  .lang button{padding:6px 10px}
}
    /* Card */
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:22px;
      box-shadow:0 12px 28px rgba(15,23,42,.12);
    }
    h1{
      margin:4px 0 4px;
      font-size:22px;
      letter-spacing:-0.02em;
    }
    p.muted{
      color:var(--muted);
      margin:0 0 10px;
      font-size:13px;
    }

    /* Grid */
    .howtouse{
      margin-top:10px;
    }
    .howtouse-grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px;
    }
    @media (max-width:1024px){
      .howtouse-grid{
        grid-template-columns:repeat(2,1fr);
      }
    }
    @media (max-width:640px){
      .howtouse-grid{
        grid-template-columns:1fr;
      }
    }

    .howtouse-item{
      position:relative;
      display:block;
      border-radius:10px;
      overflow:hidden;
      background:#ffffff;
      border:1px solid var(--border);
      aspect-ratio:1/2;          /* PC/íƒœë¸”ë¦¿ì—ì„œ ë†’ì´ ê· ì¼ */
      transition:transform .18s ease-out, box-shadow .18s ease-out, border-color .18s ease-out;
    }
    .howtouse-item img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .howtouse-item:hover{
      transform:translateY(-2px);
      box-shadow:0 12px 26px rgba(15,23,42,.14);
    }

    /* ëª¨ë°”ì¼ì—ì„œëŠ” ì›ë³¸ ë¹„ìœ¨ ìœ ì§€í•´ë„ ë¨ */
    @media (max-width:640px){
      .howtouse-item{
        aspect-ratio:auto;
      }
      .howtouse-item img{
        height:auto;
        object-fit:contain;
      }
    }

    footer{
      margin:30px auto 60px;
      text-align:center;
      color:var(--muted);
      font-size:14px;
    }

    @media (max-width:720px){
      header{
        flex-wrap:wrap;
        align-items:flex-start;
      }
      nav{
        justify-content:flex-start;
        margin-top:4px;
      }
    }
  
    /* ===== Phase 2: Step blocks (text-first) ===== */
    .htu-steps{
      display:flex;
      flex-direction:column;
      gap:14px;
      margin: 14px 0 18px;
    }
    .htu-step{
      border:1px solid var(--border);
      background: var(--card);
      border-radius: 14px;
      padding: 14px 14px 12px;
    }
    .htu-step-title{
      margin:0 0 10px;
      font-size: 36px;
      line-height: 1.25;
    }
    .htu-step-title .htu-id{
      display:none;
      font-size:12px;
      color: var(--muted);
      margin-right:10px;
      letter-spacing:.3px;
      vertical-align: baseline;
    }
    .htu-note{
      margin: 8px 0 0;
      color: var(--muted);
    }
    .htu-step ol{
      margin: 0 0 0 18px;
      padding: 0;
    }
    .htu-step li{
      margin: 6px 0;
    }
    /* Step image (2:1) : text ì•„ë˜ì— ë¶™ëŠ” ì´ë¯¸ì§€ */
    .htu-step-image{
      width: 100%;
      aspect-ratio: 2 / 1;          /* âœ… 2:1 */
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      background: #ffffff;
    }
    .htu-step-image a{
      display:block;
      width:100%;
      height:100%;
    }
    .htu-step-image img{
      width:100%;
      height:100%;
      object-fit: contain;          /* ì˜ë¦¼ ë°©ì§€ (ì›í•˜ë©´ coverë¡œ) */
      display:block;
    }

/* ===== Phase 3: Layout + Strings (themed blocks) ===== */
.htu-groups{
  display:flex;
  flex-direction:column;
  gap:18px;
  margin: 18px 0 10px;
}

/* ===== Subject Band ===== */
.htu-subject{
  width:100%;
  text-align:center;         /* ì¤‘ì•™ì •ë ¬ */
  font-size:36px;            /*  x large */
  font-weight:700;
  padding:24px 0 18px;
  margin-top:40px;
}

/* spacer */
.htu-spacer{height:18px;}
.htu-spacer.lg{height:32px;}
.htu-spacer.md{height:18px;}
.htu-spacer.sm{height:10px;}

/* ===== Grid ===== */
.htu-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);  /* PC / Tablet */
  gap:18px;
}

@media (max-width:768px){
  .htu-grid{
    grid-template-columns:1fr;          /* Mobile */
  }
}

/* ===== Image container ===== */
.htu-thumb{
  position:relative;
  display:block;
  border-radius:12px;
  overflow:hidden;
}

.htu-thumb img{
  width:100%;
  aspect-ratio:1/1;   /* 1:1 */
  object-fit:cover;
  display:block;
}

/* ===== Overlay Labels (Unified Style) ===== */
.htu-ov{
  position:absolute;
  padding:6px 10px;
  font-size:12px;                 /* ê¸°ë³¸ small */
  color:#000;                     /* black */
  background:rgba(192,192,192,0.1); /* silver 0.1 */
  border-radius:6px;
  white-space:nowrap;
  max-width: 90%; /* ë„ˆë¬´ ê¸¸ë©´ ì´ë¯¸ì§€ ë°–ìœ¼ë¡œ íŠ€ëŠ” ê²ƒ ë°©ì§€ìš©(ì„ íƒ) */

  pointer-events:none;
}

/* Title (image ìƒë‹¨ ì¤‘ì•™) */
.htu-ov.title{
  font-size:26px;                 /* x large */
  font-weight:600;
}
</style>
</head>
<body>
<header>
  <!-- Row 1 (mobile): brand left, language right -->
  <div class="header-top">
    <div class="brand">
      <!-- ê¸°ì¡´ ë¡œê³ /ë¸Œëœë“œ ë§ˆí¬ì—…ì´ ìˆìœ¼ë©´ ì—¬ê¸° ì•ˆì— ê·¸ëŒ€ë¡œ ë‘ì…”ë„ ë¨ -->
      <div class="logo" aria-hidden="true"></div>
      <strong>Measure Master</strong>
    </div>

    <div class="right">
      <div class="lang">
        <button type="button" data-lang-btn="ko">
          <span class="flag" aria-hidden="true">ğŸ‡°ğŸ‡·</span>
          <span class="label">KO</span>
        </button>
        <button type="button" data-lang-btn="en">
          <span class="flag" aria-hidden="true">ğŸ‡ºğŸ‡¸</span>
          <span class="label">EN</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Row 2 (mobile): nav centered / Desktop: nav on right -->
  <div class="header-bottom">
    <nav>
      <!-- ë©”ë‰´ëŠ” í•­ìƒ ì˜ì–´ (i18n ì ìš© X) -->
      <a href="/index.html">Home</a>
      <a href="/howtouse.html">How to use</a>
      <a href="/reviews.html">Reviews</a>
      <a href="/privacy.html">Privacy</a>
    </nav>
  </div>
</header>


<main>
  <section class="card howtouse">
    <h1>How to use Measure Master</h1>
    <p class="muted">
      Tap or click an image to open the full-size version in a new tab.
    </p>

  <!-- Phase 2 (text-first): grouped Step blocks inserted here -->
  <div id="htuSteps" class="htu-steps"></div>

  <!-- Phase 3 (layout+strings): themed blocks rendered here -->

<!-- DEBUG tools (only for editing) -->
<div id="htuDebugBar" style="display:none; gap:8px; margin:10px 0;">
  <button id="htuExportBtn" type="button">Export Layout JSON</button>
  <button id="htuCopyBtn" type="button">Copy to Clipboard</button>
</div>

<textarea id="htuExportBox" style="display:none; width:100%; height:220px;"></textarea>

  <div id="htuGallery" class="htu-groups"></div>

  </section>
</main>

<footer>
  Â© <span id="year"></span> Measure Master. All rights reserved.
</footer>

<script>
  // footer year
  document.addEventListener('DOMContentLoaded', function () {
    var y = document.getElementById('year');
    if (y) y.textContent = new Date().getFullYear();
  });
</script>


<script>
/**
 * HTU Unified Renderer
 * - Phase2: /assets/data/htu_000_layout.json  + htu_strings_{lang}.json
 * - Phase3: /assets/data/htu_layout.json      + htu_strings_{lang}.json
 * - Lang buttons refresh both at once
 */
(function(){
  const URLS = {
    phase2Layout: "/assets/data/htu_000_layout.json",
    phase3Layout: "/assets/data/htu_100_layout.json",
    strings: (lang) => `/assets/data/htu_strings_${lang}.json`
  };

  function getLang(){
    return localStorage.getItem("htu_lang") || "en";
  }
  function setLang(lang){
    localStorage.setItem("htu_lang", lang);
  }
  function t(strings, sid){
    return (strings && sid && strings[sid]) ? strings[sid] : (sid || "");
  }

  function setLangButtonsActive(lang){
    document.querySelectorAll("[data-lang-btn]").forEach(btn => {
      btn.classList.toggle("active", btn.getAttribute("data-lang-btn") === lang);
    });
  }

const DEBUG = true;

let __p3Layout = null;   // í˜„ì¬ ë¡œë”©ëœ Phase3 layout ì›ë³¸(ìˆ˜ì • ëŒ€ìƒ)
let __strings = null;    // strings (ì°¸ê³ ìš©)


  // ---------- Phase 2 (Steps) ----------
  function groupIntoSteps(rows){
    const steps = [];
    let cur = null;

    for (const r of rows){
      if (!r || typeof r !== "object") continue;
      const kind = String(r.kind ?? "").trim();

      if (kind === "step_title"){
        cur = { sid: r.sid ?? r.id ?? "", id: r.id ?? "", items: [] };
        steps.push(cur);
        continue;
      }

      if (!cur){
        cur = { sid: "htu_000", id: "htu_000", items: [] };
        steps.push(cur);
      }

      cur.items.push({
        kind,
        sid: r.sid ?? r.id ?? "",
        num: r.num
      });
    }
    return steps;
  }

  function renderPhase2(steps, strings){
    const host = document.getElementById("htuSteps");
    if (!host) return;

    host.innerHTML = "";

    for (const st of steps){
      const box = document.createElement("section");
      box.className = "htu-step";

      const h2 = document.createElement("h2");
      h2.className = "htu-step-title";
      h2.appendChild(document.createTextNode(t(strings, st.sid)));
      box.appendChild(h2);

      let ol = null;
      const flushOl = () => {
        if (ol){
          box.appendChild(ol);
          ol = null;
        }
      };

      for (const it of st.items){
        if (it.kind === "step_body"){
          if (!ol) ol = document.createElement("ol");

          const li = document.createElement("li");
          if (typeof it.num === "number") li.value = it.num;
          li.textContent = t(strings, it.sid);
          ol.appendChild(li);

        } else {
          flushOl();
          const p = document.createElement("p");
          p.className = "htu-note";
          p.textContent = t(strings, it.sid);
          box.appendChild(p);
        }
      }
      flushOl();

      // Step 1~4 image (2:1) auto-attach based on translated title text
      const titleText = t(strings, st.sid);
      const m = String(titleText || "").match(/Step\s*(\d+)\s*\./i);
      const stepNo = m ? Number(m[1]) : null;

      if (stepNo != null) {
        const imgBox = document.createElement("div");
        imgBox.className = "htu-step-image";

        const imgUrl = `/images/howtouse/howtouse_step${stepNo}.jpg`;

        const a = document.createElement("a");
        a.href = imgUrl;
        a.target = "_blank";
        a.rel = "noopener";

        const img = document.createElement("img");
        img.src = imgUrl;
        img.alt = `HowToUse Step ${stepNo}`;
        img.loading = "lazy";

        a.appendChild(img);
        imgBox.appendChild(a);
        box.appendChild(imgBox);
      }

      host.appendChild(box);
    }
  }

  // ---------- Phase 3 (Overlay Gallery) ----------
  function applyAnchorStyle(el, x, y, anchor){
    el.style.left = (x ?? 50) + "%";
    el.style.top  = (y ?? 50) + "%";

    const a = anchor || "top-left";
    let tx = "0%";
    let ty = "0%";

    if (a.includes("center")) tx = "-50%";
    if (a.includes("right"))  tx = "-100%";
    if (a.includes("bottom")) ty = "-100%";
    if (a === "center") { tx = "-50%"; ty = "-50%"; }
    if (a === "top-center") { tx = "-50%"; ty = "0%"; }
    if (a === "bottom-center") { tx = "-50%"; ty = "-100%"; }
    if (a === "center-right") { tx = "-100%"; ty = "-50%"; }
    if (a === "center-left") { tx = "0%"; ty = "-50%"; }

    el.style.transform = `translate(${tx}, ${ty})`;
  }

  function renderPhase3(layout, strings){
    const host = document.getElementById("htuGallery");
    if (!host) return;

    host.innerHTML = "";

    let grid = null;
    const flushGrid = () => {
      if (grid){
        host.appendChild(grid);
        grid = null;
      }
    };

    for (const node of layout){
      if (!node || typeof node !== "object") continue;

      if (node.kind === "subject"){
        flushGrid();
        const band = document.createElement("div");
        band.className = "htu-subject";
        band.textContent = t(strings, node.sid);
        host.appendChild(band);
        continue;
      }

      if (node.kind === "spacer"){
        flushGrid();
        const sp = document.createElement("div");
        sp.className = `htu-spacer ${(node.size || "md")}`;
        host.appendChild(sp);
        continue;
      }

      if (node.kind === "image"){
        if (!grid){
          grid = document.createElement("div");
          grid.className = "htu-grid";
        }

        const a = document.createElement("a");
        a.className = "htu-thumb";
        a.href = node.src;
        a.target = "_blank";
        a.rel = "noopener";

        const img = document.createElement("img");
        img.src = node.src;
        img.alt = t(strings, node.altSid);
        img.loading = "lazy";
        a.appendChild(img);

        const ovs = Array.isArray(node.overlays) ? node.overlays : [];
        for (const ov of ovs){
          const div = document.createElement("div");
          div.className = "htu-ov " + (ov.role === "title" ? "title" : "");
          div.textContent = t(strings, ov.sid);
          applyAnchorStyle(div, ov.x, ov.y, ov.anchor);

  // âœ… [ì •í™•í•œ ì‚½ì… ìœ„ì¹˜] applyAnchorStyle(...) ë‹¤ìŒ, a.appendChild(div) ì§ì „
          if (typeof ov.w === "number") {
            div.style.width = ov.w + "%";
            div.style.whiteSpace = "normal";     // ì¤„ë°”ê¿ˆ í—ˆìš©
            div.style.wordBreak = "break-word";// âœ… ê¸´ ë‹¨ì–´ ê°•ì œ ì¤„ë°”ê¿ˆ
           }

          a.appendChild(div);


        if (DEBUG){
           div.style.pointerEvents = "auto";
           div.style.cursor = "move";

           let dragging = false;

          div.addEventListener("mousedown", () => { dragging = true; });
          document.addEventListener("mouseup", () => { dragging = false; });

           document.addEventListener("mousemove", (e) => {
          if (!dragging) return;

    const rect = a.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width) * 100;
    const y = ((e.clientY - rect.top) / rect.height) * 100;

    div.style.left = x + "%";
    div.style.top  = y + "%";

    ov.x = Number(x.toFixed(2));   // âœ… layoutì—ë„ ê¸°ë¡
    ov.y = Number(y.toFixed(2));   // âœ… layoutì—ë„ ê¸°ë¡


    console.log(ov.sid, "x:", x.toFixed(2), "y:", y.toFixed(2));
  });

  div.addEventListener("wheel", (e) => {
    e.preventDefault();
    let size = parseFloat(getComputedStyle(div).fontSize);
    size += (e.deltaY < 0 ? 1 : -1);
    div.style.fontSize = size + "px";
  }, { passive:false });
}

        }

        grid.appendChild(a);
        continue;
      }
    }

    flushGrid();
  }

  // ---------- Unified load + render ----------
  async function loadAllAndRender(){
    const lang = getLang();
    setLangButtonsActive(lang);

    const [p2Res, p3Res, strRes] = await Promise.all([
      fetch(URLS.phase2Layout, { cache: "no-store" }),
      fetch(URLS.phase3Layout, { cache: "no-store" }),
      fetch(URLS.strings(lang), { cache: "no-store" })
    ]);

    if (!p2Res.ok) throw new Error("Phase2 layout HTTP " + p2Res.status);
    if (!p3Res.ok) throw new Error("Phase3 layout HTTP " + p3Res.status);
    if (!strRes.ok) throw new Error("Strings HTTP " + strRes.status);

    const [p2Layout, p3Layout, strings] = await Promise.all([
      p2Res.json(), p3Res.json(), strRes.json()
    ]);

  __p3Layout = p3Layout;   // âœ… ì¶”ê°€: Phase3 layout ì €ì¥
  __strings  = strings;    // âœ… (ì„ íƒ) strings ì €ì¥

    if (Array.isArray(p2Layout)){
      const steps = groupIntoSteps(p2Layout);
      renderPhase2(steps, strings);
    }
    if (Array.isArray(p3Layout)){
      renderPhase3(p3Layout, strings);
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    // language buttons
    document.querySelectorAll("[data-lang-btn]").forEach(btn => {
      btn.addEventListener("click", () => {
        const lang = btn.getAttribute("data-lang-btn");
        setLang(lang);
        loadAllAndRender().catch(e => console.warn("[HTU] render failed:", e));
      });
    });

    loadAllAndRender().catch(e => console.warn("[HTU] render failed:", e));
    // DEBUG export tools
    const bar = document.getElementById("htuDebugBar");
    const box = document.getElementById("htuExportBox");
    const exportBtn = document.getElementById("htuExportBtn");
    const copyBtn = document.getElementById("htuCopyBtn");

    if (DEBUG && bar && box && exportBtn && copyBtn){
      bar.style.display = "flex";
      box.style.display = "block";

      exportBtn.addEventListener("click", () => {
        if (!__p3Layout) {
          alert("Phase3 layout not loaded yet.");
          return;
        }
        box.value = JSON.stringify(__p3Layout, null, 2);
      });

      copyBtn.addEventListener("click", async () => {
        try{
          await navigator.clipboard.writeText(box.value || "");
          alert("Copied!");
        }catch(e){
          alert("Copy failed. Select all and copy manually.");
        }
      });
    }
  });
})();
</script>

</body>
</html>
